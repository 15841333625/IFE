<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ife js function</title>
</head>

<body>
    <h1 id="now"></h1>
    <h1 id="anonow"></h1>
    
<!--    有一堆Select用于选择日期和时间，在选择后，实时在 id 为 result-wrapper 的 p 标签中显示所选时间和当前时间的差值-->
    
    <select id="year-select">
        <option value="2000">2000</option>
        <option value="2001">2001</option>
        <option value="2002">2002</option>
        <option value="2003">2003</option>
        <option value="2004">2004</option>
        <option value="2005">2005</option>
        <option value="2006">2006</option>
        <option value="2018">2018</option>
        <option value="2019">2019</option>
        <option value="2020">2020</option>
        <option value="2021">2021</option>
        <option value="2022">2022</option>
    </select>

    <select id="month-select">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
    </select>

    <select id="day-select">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
    </select>

    <select id="hour-select">
        <option value="0">00</option>
        <option value="1">01</option>        
        <option value="2">02</option>
        <option value="3">03</option>
        <option value="4">04</option>
        <option value="5">05</option>
        <option value="6">06</option>
        <option value="7">07</option>
        <option value="8">08</option>
        <option value="9">09</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
    </select>

    <select id="minite-select">
        <option value="0">00</option>
        <option value="1">01</option>       
        <option value="2">02</option>
        <option value="3">03</option>
        <option value="4">04</option>
        <option value="5">05</option>
        <option value="6">06</option>
        <option value="7">07</option>
        <option value="8">08</option>
        <option value="9">09</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
        <option value="32">32</option>        
        <option value="33">33</option>
        <option value="34">34</option>
        <option value="35">35</option>
        <option value="36">36</option>
        <option value="37">37</option>
        <option value="38">38</option>
        <option value="39">39</option>
        <option value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
        <option value="46">46</option>
        <option value="47">47</option>
        <option value="48">48</option>
        <option value="49">49</option>
        <option value="50">50</option>
        <option value="51">51</option>
        <option value="52">52</option>
        <option value="53">53</option>
        <option value="54">54</option>
        <option value="55">55</option>
        <option value="56">56</option>
        <option value="57">57</option>
        <option value="58">58</option>
        <option value="59">59</option>
    </select>

    <select id="second-select">
        <option value="0">00</option>
        <option value="1">01</option>       
        <option value="2">02</option>
        <option value="3">03</option>
        <option value="4">04</option>
        <option value="5">05</option>
        <option value="6">06</option>
        <option value="7">07</option>
        <option value="8">08</option>
        <option value="9">09</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
        <option value="32">32</option>        
        <option value="33">33</option>
        <option value="34">34</option>
        <option value="35">35</option>
        <option value="36">36</option>
        <option value="37">37</option>
        <option value="38">38</option>
        <option value="39">39</option>
        <option value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
        <option value="46">46</option>
        <option value="47">47</option>
        <option value="48">48</option>
        <option value="49">49</option>
        <option value="50">50</option>
        <option value="51">51</option>
        <option value="52">52</option>
        <option value="53">53</option>
        <option value="54">54</option>
        <option value="55">55</option>
        <option value="56">56</option>
        <option value="57">57</option>
        <option value="58">58</option>
        <option value="59">59</option>
    </select>

    <p id="result-wrapper">现在距离 2001年1月1日星期X HH:MM:SS 还有 X 天 X 小时 X 分 X 秒</p>
    <script>
        // 根据日期判断星期
        function getWeekDay(d) {
            var weekday=new Array(7);
            
            weekday[0]="星期日";
            weekday[1]="星期一";
            weekday[2]="星期二";
            weekday[3]="星期三";
            weekday[4]="星期四";
            weekday[5]="星期五";
            weekday[6]="星期六";
            
            return weekday[d.getDay()]
        }
        
        function getWeekDay2(d) {
            var weekday=new Array(7);
            
            weekday[0]="Sunday";
            weekday[1]="Monday";
            weekday[2]="Tuesday";
            weekday[3]="Wednesday";
            weekday[4]="Thursday";
            weekday[5]="Friday";
            weekday[6]="Saturday";
            
            return weekday[d.getDay()]
        }
        
        // 将所有时间变成2位数
        function formatDateStr(str) {
            if(str.toString().length === 1)
                str = "0" + str;
            return str;
        }
        
        // 获得具体时间
        function getSepTime(d) {
            if (d.getHours() <= 12) 
                return (formatDateStr(d.getHours()) + ":" + 
                        formatDateStr(d.getMinutes()) + ":" + 
                        formatDateStr(d.getSeconds()) + " AM");
            else 
                return (formatDateStr(d.getHours() - 12) + ":" + 
                        formatDateStr(d.getMinutes()) + ":" + 
                        formatDateStr(d.getSeconds()) + " PM");
        }
        
        function getSepTime2(d) {
            return (formatDateStr(d.getFullYear()) + "年" +
                    formatDateStr(d.getMonth()) + "月" + 
                    formatDateStr(d.getDate()) + "日 " + 
                    getWeekDay(d) + " " + 
                    formatDateStr(d.getHours()) + ":" + 
                    formatDateStr(d.getMinutes()) + ":" + 
                    formatDateStr(d.getSeconds()));
        }
        
        // 获得当前时间
        function getCurrentTime() {
            var now = document.getElementById("now");
            var now2 = document.getElementById("anonow");
            var mydate = new Date();
            
            var fulldate1 = getSepTime2(mydate);
            
            var fulldate2 = formatDateStr(mydate.getFullYear()) + "-" +
                formatDateStr(mydate.getMonth()) + "-" + 
                formatDateStr(mydate.getDate()) + " " + 
                getWeekDay2(mydate) + " " + 
                getSepTime(mydate);
            
            now.innerHTML = fulldate1;
            now2.innerHTML = fulldate2;
        }
        
        // 每秒更新
        var timer = setInterval(getCurrentTime, 1000);
        
        // 获得所选日期
        function getSelDate() {
            var year = document.getElementById("year-select").value;
            var month = document.getElementById("month-select").value;
            var day = document.getElementById("day-select").value;
            var hour = document.getElementById("hour-select").value;
            var minite = document.getElementById("minite-select").value;
            var second = document.getElementById("second-select").value;
            
            var d = new Date(year, month, day, hour, minite, second);
            
            return d;
        }
        
        // 同当前时间比较 
        function compDate(d) {
            var currentTime = new Date();
            
            var md = d.getTime();
            var mc = currentTime.getTime();
            
            var wenan = "";
            
            if(md >= mc) {
                var diff = md - mc;
                var diffDay = parseInt(diff / 86400000);
                diff -= diffDay * 86400000;
                var diffHour = parseInt(diff / 3600000);
                diff -= diffHour * 360000;
                var diffMinite = parseInt(diff / 60000);
                diff -= diffMinite * 60000;
                var diffSec = parseInt(diff / 1000);
                
                wenan = "距离 " + getSepTime2(d) + " 还有 " + diffDay + "天" + diffHour + "小时" + diffMinite + "分钟" + diffSec + "秒";
            } else {
                var diff = mc - md;
                var diffDay = parseInt(diff / 86400000);
                diff -= diffDay * 86400000;
                var diffHour = parseInt(diff / 3600000);
                diff -= diffHour * 360000;
                var diffMinite = parseInt(diff / 60000);
                diff -= diffMinite * 60000;
                var diffSec = parseInt(diff / 1000);
                
                wenan = "距离 " + getSepTime2(d) + " 已经过去 " + diffDay + "天" + diffHour + "小时" + diffMinite + "分钟" + diffSec + "秒";
            }
            
            return wenan;
        }
        
        // 添加选择事件
        var selects = document.getElementsByTagName("select");
        for(var i = 0; i < selects.length; i ++) {
            selects[i].addEventListener("change", function() {
                var selDate = getSelDate();
                var wenan = compDate(selDate);
                
                document.getElementById("result-wrapper").innerHTML = wenan;
            })
        };
        
        // 检查日期是否合法
        document.getElementById("day-select").addEventListener('click', function() {
            var year = parseInt(document.getElementById("year-select").value);
            var month = parseInt(document.getElementById("month-select").value);
            
            if(month === 4 || month === 6 || month === 9 || month === 11) {
                var ops = this.getElementsByTagName('option');
                    for(var i = 0; i < ops.length; i ++) {
                        if(ops[i].value === '31') {
                            ops[i].disabled = true;
                        } else {
                            ops[i].disabled = false;
                        }
                    }
            }
            
            if(month === 2) {
                var ops = this.getElementsByTagName('option');
                for(var i = 0; i < ops.length; i ++) {
                    if(year % 4 === 0) {
                        if(ops[i].value === '30' || ops[i].value === '31') {
                            ops[i].disabled = true;
                        } else {
                            ops[i].disabled = false;
                        }
                    } else {
                        if(ops[i].value === '29' || ops[i].value === '30' || ops[i].value === '31') {
                            ops[i].disabled = true;
                        } else {
                            ops[i].disabled = false;
                        }
                    }
                }
            }
        });
        document.getElementById("year-select").addEventListener('click', function() {
            document.getElementById("day-select").value = '1';
        });
        document.getElementById("month-select").addEventListener('click', function() {
            document.getElementById("day-select").value = '1';
        });
    </script>
</body>
</html>
